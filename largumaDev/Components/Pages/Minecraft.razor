@page "/Minecraft"
@using largumaDev.Components.Layout
@using Microsoft.VisualBasic
@using System.Text
@using System.Threading
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>Minecraft Mods - Larguma</PageTitle>

<div class="minecraft-page">
  <div class="page-header">
    <h1>🎮 Minecraft Modding</h1>
    <p class="subtitle">get modded</p>
  </div>

  <div class="intro-section">
    <p class="intro-text">
      Minecraft vanilla is good but a little bit boring after like 10k+ hours. So mods are needed. There are a lot of
      mods; but not enough, never enough ! And I like game dev so I make mods.
    </p>
  </div>

  <div class="mods-section">
    <h2>⚙️ My Mods</h2>

    <div class="mod-card">
      <div class="mod-header">
        <h3>Crawling Mysteries</h3>
        <span class="badge">First Release</span>
      </div>
      <p class="mod-description">
        My first mod I tried making 2 years ago ! And I restarted developping it the other day. It's now for Minecraft
        1.21.1 on Neoforge. Go check it out on Modrinth and leaves suggestions. This time I will finish it I hope (:
      </p>
      <div class="mod-badge-container">
        <ModrinthBadge slug="crawling-mysteries" />
      </div>
    </div>

    <div class="coming-soon">
      <h3>🚀 What's Next ?</h3>
      <p>
        More mods are in the works (or at least the idea of more mods). I'm trying new loader and libraries.
        Everything will be posted here, on Modrinth and CurseForge (eventually).
      </p>
    </div>
  </div>

  <div class="mods-section">
    <h2>⚙️ Utils</h2>

    <div class="mod-card">
      <div class="mod-header">
        <h3>Pretty mod-badge-generator</h3>
      </div>
      <p class="mod-description">
        A nice looking SVG badge generator for absolutely everything (mods, ressource packs, data packs, shaders,
        modpacks, plugins) on Modrinth, just input the project slug : <a
          href="/modrinth/badge/fabric-api">/modrinth/badge/{slug}</a>
      </p>
      <div class="mod-badge-container badge-carousel">
        @for (int i = 0; i < slugs.Count; i++)
        {
          <ModrinthBadge slug="@slugs[i]" isActive="@(i == currentBadgeIndex)" />
        }
      </div>
    </div>
  </div>

  <div class="links-section">
    <h2>🔗 Links</h2>
    <div class="links-grid">
      <a href="https://modrinth.com/user/Larguma" target="_blank" rel="noopener noreferrer" class="link-card modrinth">
        <div class="link-icon">💚</div>
        <div class="link-content">
          <strong>Modrinth</strong>
          <span>Modrinth is BAE</span>
        </div>
      </a>
      <a href="https://www.curseforge.com/members/Larguma" target="_blank" rel="noopener noreferrer"
        class="link-card curseforge">
        <div class="link-icon">🔥</div>
        <div class="link-content">
          <strong>CurseForge</strong>
          <span>Use Modrinth instead</span>
        </div>
      </a>
    </div>
  </div>
</div>

@code {
  private List<string> slugs = ["fabric-api", "fresh-animations", "veinminer", "complementary-reimagined",
"fabulously-optimized", "simple-voice-chat"];
  private int currentBadgeIndex = 0;
  private PeriodicTimer? _timer;
  private CancellationTokenSource _cts = new();


  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (firstRender)
    {
      _timer = new PeriodicTimer(TimeSpan.FromSeconds(5));
      while (await _timer.WaitForNextTickAsync(_cts.Token))
      {
        currentBadgeIndex = (currentBadgeIndex + 1) % slugs.Count;
        await InvokeAsync(StateHasChanged);
      }
    }
  }

  public void Dispose()
  {
    _cts.Cancel();
    _timer?.Dispose();
    _cts.Dispose();
  }
}